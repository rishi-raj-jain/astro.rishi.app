---
import SearchBar from '../components/SearchBar'
import DateString from '../components/DateString'
import MainLayout from '../layouts/MainLayout.astro'
import { getAllPostsForHome, getRecommendedPosts, getTagline } from '../api'
import RichTextResolver from 'storyblok-js-client/dist/rich-text-resolver.cjs'

let data = undefined

try {
  const allPosts = await getAllPostsForHome()
  const recommendedPosts = await getRecommendedPosts()
  const blogsTagline = await getTagline('blogs')
  data = { allPosts, recommendedPosts, blogsTagline }
} catch (e) {
  console.log(e)
}
---

<MainLayout valid={data} content={{ title: 'Blogs - Rishi Raj Jain' }}>
  <div class="flex flex-col">
    <h1 class="text-2xl font-bold sm:text-5xl">Blogs</h1>
    <h2
      class="font-regular text-md mt-5 whitespace-pre-line dark:text-gray-400 sm:text-xl"
      set:html={new RichTextResolver().render(data.blogsTagline)}
    >
    </h2>
    <SearchBar client:visible content={data.allPosts} />
    <div class="flex flex-row flex-wrap">
      <div class="mt-10 flex w-full flex-col lg:mt-20 lg:w-2/3 lg:pr-10">
        {
          data.allPosts.map((item) => (
            <div class="mb-10 flex flex-col border-b pb-10 dark:border-gray-700">
              <span class="text-gray-700 dark:text-gray-400">
                <DateString date={new Date(item.first_published_at)} />
              </span>
              <a class="hover:underline text-lg font-bold sm:text-2xl" href={`/blog/${item.slug}`}>
                {item.content.title}
              </a>
              <span class="mt-3 text-sm text-gray-700 line-clamp-2 dark:text-gray-400">{item.content.intro}</span>
              <a href={`/blog/${item.slug}`} />
              <a href={`/blog/${item.slug}`} class="mt-5 text-sm uppercase text-blue-500 hover:underline">
                Read More &rarr;
              </a>
            </div>
          ))
        }
      </div>
      <div class="mt-0 flex w-full flex-col lg:mt-20 lg:w-1/3">
        <h4 class="text-md font-bold sm:text-lg">Recommended Posts</h4>
        {
          data.recommendedPosts.map((item) => (
            <a
              rel="noopener"
              target="_blank"
              href={item.content.Url.url}
              class="mt-5 truncate border-b pb-2 text-sm text-gray-500 hover:underline dark:border-gray-700 dark:text-gray-400"
            >
              {item.content.Title}
            </a>
          ))
        }
      </div>
    </div>
  </div>
</MainLayout>
